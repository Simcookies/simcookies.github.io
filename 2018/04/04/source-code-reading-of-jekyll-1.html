<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Source code reading of Jekyll -- 1</title><meta name="description" content="It has been long time since I wanted to study Ruby by reading source code of some project from some open source project. I choosed the Jekyll because it’s sm..."><link rel="shortcut icon" type="image/x-icon" href="/public/favicon.ico"><link rel="stylesheet" href="/public/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.css" integrity="sha512-EaaldggZt4DPKMYBa143vxXQqLq5LE29DG/0OoVenoyxDrAScYrcYcHIuxYO9YNTIQMgD8c8gIUU8FQw7WpXSQ==" crossorigin="anonymous"><link rel="canonical" href="https://simcookies.github.io/2018/04/04/source-code-reading-of-jekyll-1"><link rel="alternate" type="application/rss+xml" title="Simcookies" href="https://simcookies.github.io/feed.xml"><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/simple-jekyll-search/1.7.12/simple-jekyll-search.min.js" integrity="sha512-APy7Ff/y4pdIHleqiTMcRZ8Wu6tjfqhJpgAcaCvTuFQPj/G+/A5u0uZi/DkfkuLQ6FeFmDJgh/zl0y3If/VUyA==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.8.2/mermaid.min.js" integrity="sha512-x8NWYlEsC86ngfO24tbxW6pMuyn9gYnwEW0FcSobohDc3iLCXhmRkqYXgTfE7Jwy2YCTnHRfyum8LUIiyvmgWQ==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha512-Fv0JVzxvrWFLhiUP8wZYR6VwBZQt0XqB9MhHZE+12lObqIDzg3LOJcCCiRy6g4MCX/MlG+R9IRCWZAHjo9iBgw==" crossorigin="anonymous"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
      showProcessingMessages: false,
      messageStyle: "none",
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
      }
    });</script><script src="/public/script/main.js"></script></head><body><header class="site-header"><div class="wrapper"><a class="site-title" href="/">Simcookies</a> <span class="menu-icon" id="menu-icon"><span class="fa-stack fa-lg"><i class="fa fa-square-o fa-stack-2x"></i> <i class="fa fa-bars fa-stack-1x"></i></span></span><nav class="site-nav"><div class="trigger"><a class="page-link" href="/about/">About</a> <a class="page-link" href="/archive/">Archive</a> <a class="page-link" href="/wiki/">Wiki</a> <a class="page-link" href="/feed.xml">Feeds</a> <a class="page-link" href="https://github.com/simcookies/gitio" target="_blank" rel="noopener noreferrer"><i class="fa fa-github-alt fa-lg"></i> Repositories</a></div></nav></div></header><div class="scroll-content"><div class="page-content"><div class="wrapper"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header"><h1 class="post-title" itemprop="name headline">Source code reading of Jekyll -- 1</h1><p class="post-meta"><time datetime="2018-04-04T15:27:12+09:00" itemprop="datePublished">Apr 4, 2018</time>  <i class="fa fa-archive" aria-hidden="true"></i>  <span><a class="category-div" href="/category/programming">programming</a></span>  <i class="fa fa-tag"></i>  <a class="tag-div" href="/tag/source">source</a>  <a class="tag-div" href="/tag/jekyll">jekyll</a> </p></header><div class="post-content" itemprop="articleBody"><p>It has been long time since I wanted to study Ruby by reading source code of some project from some open source project. I choosed the Jekyll because it’s small and popular in static pages generator. It is my first time to read source codes, I will choose the appropriate way for me. It you have any advices for me, please feel free to reply this article.</p><p>I plan to begin from files at root dir, and then go on directories. Finally, return root dir and make a summary of this project.</p><h1 id="jeykllgemspec">jeykll.gemspec</h1><blockquote><p><code class="language-plaintext highlighter-rouge">gemspec</code> includes basic infos of the Jekyll project. It is necessary in a RubyGem project.</p></blockquote><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lib</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"lib"</span><span class="p">,</span> <span class="n">__dir__</span><span class="p">)</span>
<span class="vg">$LOAD_PATH</span><span class="p">.</span><span class="nf">unshift</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span> <span class="k">unless</span> <span class="vg">$LOAD_PATH</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span>
<span class="nb">require</span> <span class="s2">"jekyll/version"</span>
</code></pre></div></div><p>Load the <code class="language-plaintext highlighter-rouge">lib/</code> dir into built-in var <code class="language-plaintext highlighter-rouge">$LOAD_PATH</code> and require <code class="language-plaintext highlighter-rouge">jekyll/version.rb</code> which includes version info of Jekyll. <code class="language-plaintext highlighter-rouge">File.expand_path</code> converts a pathname to an absolute pathname. <code class="language-plaintext highlighter-rouge">unshift</code> can prepend objects to the front of self.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="o">...</span>
  <span class="n">all_files</span> <span class="o">=</span> <span class="sb">`git ls-files -z`</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\x0</span><span class="s2">"</span><span class="p">)</span>
  <span class="o">...</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">bindir</span> <span class="o">=</span> <span class="s2">"exe"</span>
  <span class="o">...</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">add_runtime_dependency</span><span class="p">(</span><span class="s2">"addressable"</span><span class="p">,</span> <span class="s2">"~&gt; 2.4"</span><span class="p">)</span>
  <span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div><p>Use ` ` to execute a shell script, the script here can get all files under the management of git. <code class="language-plaintext highlighter-rouge">s.bindir = "exe"</code> specify the executable ruby script in <code class="language-plaintext highlighter-rouge">exe/</code>. <code class="language-plaintext highlighter-rouge">add_runtime_dependency</code> adds a runtime dependency named gem with requirements to this gem.</p><p>We can install Jekyll by <code class="language-plaintext highlighter-rouge">gem install jekyll</code>, and gem will create a exculatable ruby script in <code class="language-plaintext highlighter-rouge">gems/ruby-2.X.X/bin</code>. Implement in console of <code class="language-plaintext highlighter-rouge">jekyll</code> will call <code class="language-plaintext highlighter-rouge">exe/jekyll</code>.</p><hr><h1 id="exejekyll">exe/jekyll</h1><blockquote><p>Execulatable ruby script which defined in jekyll.gemspec.</p></blockquote><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">STDOUT</span><span class="p">.</span><span class="nf">sync</span> <span class="o">=</span> <span class="kp">true</span>
</code></pre></div></div><p>Normally <code class="language-plaintext highlighter-rouge">puts</code> does not write immediately to <code class="language-plaintext highlighter-rouge">STDOUT</code>, but this can write every single character immediately to the console<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote">1</a></sup>. It is very useful when build websocket server.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Jekyll</span><span class="o">::</span><span class="no">PluginManager</span><span class="p">.</span><span class="nf">require_from_bundler</span>
</code></pre></div></div><p>Call the <code class="language-plaintext highlighter-rouge">require_from_bundler</code> method which defined in <code class="language-plaintext highlighter-rouge">lib/jekyll/plugin_manager.rb</code>. In fact, <code class="language-plaintext highlighter-rouge">require "jekyll"</code> will load jekyll.rb file, and all other modules are loaded in this file by <code class="language-plaintext highlighter-rouge">autoload :XXX, "jekyll/xxx"</code>.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Jekyll</span><span class="o">::</span><span class="no">Deprecator</span><span class="p">.</span><span class="nf">process</span><span class="p">(</span><span class="no">ARGV</span><span class="p">)</span>
</code></pre></div></div><p>This method will deal with arguments deprecated which defined in <code class="language-plaintext highlighter-rouge">lib/jekyll/deprecator.rb</code>. It will show the error messages and abort calling.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"mercenary"</span>
<span class="o">...</span>
<span class="no">Mercenary</span><span class="p">.</span><span class="nf">program</span><span class="p">(</span><span class="ss">:jekyll</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span>
  <span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div><p><a href="https://github.com/jekyll/mercenary" target="_blank" rel="noopener noreferrer">Mercenary</a> is lightweight and flexible library for writing command-line apps in Ruby which is also a sub-repo of Jekyll. This gem may be useful in development of gem.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Jekyll</span><span class="o">::</span><span class="no">Command</span><span class="p">.</span><span class="nf">subclasses</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="p">.</span><span class="nf">init_with_program</span><span class="p">(</span><span class="nb">p</span><span class="p">)</span>
</code></pre></div></div><p>Initilization of Jekyll commands in block of Mercenary. These commands are defined in <code class="language-plaintext highlighter-rouge">lib/jekyll/command.rb</code>.</p><p><code class="language-plaintext highlighter-rouge">Jekyll.logger</code> is using to manage logs.</p><h1 id="libjekyllrb">lib/jekyll.rb</h1><blockquote><p>Require necessary libs to this project in lib/jekyll.rb</p></blockquote><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">require_all</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
  <span class="n">glob</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">__dir__</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="s2">"*.rb"</span><span class="p">)</span>
  <span class="no">Dir</span><span class="p">[</span><span class="n">glob</span><span class="p">].</span><span class="nf">sort</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
    <span class="nb">require</span> <span class="n">f</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>As it said of comment, this method requires all of the Ruby files in the given directory.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># internal requires</span>
<span class="nb">autoload</span> <span class="ss">:Cleaner</span><span class="p">,</span> <span class="s2">"jekyll/cleaner"</span>
<span class="o">...</span>
<span class="c1"># extensions</span>
<span class="nb">require</span> <span class="s2">"jekyll/plugin"</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">lib/jekyll.rb</code> requires <code class="language-plaintext highlighter-rouge">rubygems</code>, stdlib and 3rd party libs firstly. Also it will claim its own modules using <code class="language-plaintext highlighter-rouge">autoload</code> and <code class="language-plaintext highlighter-rouge">require</code>.<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote">2</a></sup></p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
  <span class="k">def</span> <span class="nf">some_method</span>
    <span class="o">...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">class &lt;&lt; self</code> opens up <code class="language-plaintext highlighter-rouge">self</code>’s singleton class, so that methods can be redefined for the current <code class="language-plaintext highlighter-rouge">self</code> object. With this syntax, we don’t need to write <code class="language-plaintext highlighter-rouge">def self.some_method</code> in the module everytime.<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote">3</a></sup></p><p>There are such a set of methods defined in the <code class="language-plaintext highlighter-rouge">class &lt;&lt; self</code> block:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">env</span>            <span class="c1"># jekyll environment</span>
<span class="n">configuration</span>  <span class="c1"># configuration Hash by merging the default options with anything in _config.yml</span>
<span class="n">set_timezone</span>   <span class="c1"># Set the TZ environment variable</span>
<span class="n">logger</span>         <span class="c1"># logger instance</span>
<span class="n">logger</span><span class="o">=</span>        <span class="c1"># set logger writer</span>
<span class="n">sites</span>          <span class="c1"># Jekyll sites created</span>
<span class="n">sanitized_path</span> <span class="c1"># Returns the sanitized path</span>
</code></pre></div></div><hr><div class="footnotes" role="doc-endnotes"><ol><li id="fn:1" role="doc-endnote"><p>Stackoverflow: <a href="https://stackoverflow.com/questions/29998728/what-stdout-sync-true-means" target="_blank" rel="noopener noreferrer">What STDOUT.sync = true means?</a>. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p></li><li id="fn:2" role="doc-endnote"><p>About the difference between <code class="language-plaintext highlighter-rouge">autoload</code> and <code class="language-plaintext highlighter-rouge">require</code>, reference is <a href="https://stackoverflow.com/questions/804297/when-to-use-require-load-or-autoload-in-rubyutm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa" target="_blank" rel="noopener noreferrer">here</a>. And I plan to write an another article about this. <a href="#fnref:2" class="reversefootnote" role="doc-backlink">↩</a></p></li><li id="fn:3" role="doc-endnote"><p>Stackoverflow: <a href="https://stackoverflow.com/questions/2505067/class-self-idiom-in-rubyutm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa" target="_blank" rel="noopener noreferrer">class « self idiom in Ruby</a>. <a href="#fnref:3" class="reversefootnote" role="doc-backlink">↩</a></p></li></ol></div></div><hr><div class="post-nav"><a href="/2017/12/02/fullstack-reference" class="left link">&lt;&lt; Previous </a><a href="/2018/05/05/draw-uml-with-plantuml-in-atom" class="right link">Next &gt;&gt;</a></div><hr><div id="disqus_thread"></div><script>/**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
  */
  /*
  var disqus_config = function () {
  this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };
  */
  (function() {  // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');

  s.src = '//simcookiesgithubio.disqus.com/embed.js';

  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="noopener noreferrer" target="_blank">comments powered by Disqus.</a></noscript></article><div class="mark-link"><a id="bookmark"><span class="fa-stack fa-lg"><i class="fa fa-square fa-stack-2x"></i> <i class="fa fa-book fa-stack-1x fa-inverse"></i></span></a></div><div id="toc-area" class="sidebar" style="display:none"><div class="col toc-area">  <i class="fa fa-bookmark" aria-hidden="true"></i>  Table of Contents<ul class="section-nav"><li class="toc-entry toc-h1"><a href="#jeykllgemspec">jeykll.gemspec</a></li><li class="toc-entry toc-h1"><a href="#exejekyll">exe/jekyll</a></li><li class="toc-entry toc-h1"><a href="#libjekyllrb">lib/jekyll.rb</a></li></ul></div></div></div></div><footer class="site-footer">© 2016~2021 by Simcookies. All rights reserved.<div class="quick-link" id="quick-link"><a id="page-top"><span class="fa-stack fa-lg"><i class="fa fa-square fa-stack-2x"></i> <i class="fa fa-arrow-up fa-stack-1x fa-inverse"></i> </span></a><a href="/"><span class="fa-stack fa-lg"><i class="fa fa-square fa-stack-2x"></i> <i class="fa fa-home fa-stack-1x fa-inverse"></i></span></a></div></footer></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                           m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85209586-1', 'auto');
  ga('send', 'pageview');</script></body></html>